# MIxS Project Build System Documentation

## Overview

This document provides comprehensive documentation for all Makefile targets, Python scripts, and related configurations in the MIxS project build system.

The Minimum Information about any (X) Sequence (MIxS) standard is maintained by the Genomic Standards Consortium (GSC) and utilizes the [LinkML](https://linkml.io/linkml/) framework for schema management. The source of truth for MIxS is the [YAML schema file](src/mixs/schema/mixs.yaml), which defines metadata terms for genomic sequences across various environments.

## Project Configuration

### Poetry Configuration (`pyproject.toml`)

- **Project**: MIxS v6.2.0 - Minimum Information about any (X) Sequence standard
- **License**: CC0-1.0
- **Python Version**: ^3.9
- **Build System**: Poetry with dynamic versioning

#### Key Dependencies
- **Core**: `linkml-runtime ^1.9.1`, `rdflib ^6.2.0`, `pandas ^2.2.0`, `PyYAML ^6.0`
- **Development**: `linkml ^1.9.1`, `schemasheets ^0.1.18`, `black ^24.3.0`, `yamllint ^1.35.1`
- **Documentation**: `mkdocs-material ^9.0.12`, `mkdocs-mermaid2-plugin ^0.6.0`

#### Poetry Scripts
- `extension-distances`: Generate dendrogram of extension similarities
- `extension-differences`: Compare slots between two extensions  
- `linkml2class-tsvs`: Generate TSV files for each schema class

### LinkML Generator Configuration (`project-generator-config.yaml`)

Controls which formats are generated by `linkml generate project`:
- **Included**: graphql, jsonld, jsonschema, owl, python, shacl, shex, etc.
- **Excluded**: csv, excel, markdown, golang, java, etc.
- **Special OWL Configuration**: Custom settings for ontology generation

## Makefile Targets

### Main Makefile

#### Setup & Dependencies
| Target | Description | Dependencies |
|--------|-------------|--------------|
| `install` | Install project dependencies using Poetry | None |
| `help` | Show help information and status | `status` |
| `status` | Display project information (name, source path) | None |

#### Development & Testing  
| Target | Description | Dependencies |
|--------|-------------|--------------|
| `lint` | Perform schema linting with linkml-lint | None |
| `test` | Run all tests (schema, python, examples) | `test-schema`, `test-python`, `test-examples` |
| `test-schema` | Generate project files to temporary directory for validation | None |
| `test-python` | Run Python unit tests | None |
| `test-examples` | Process example files and generate outputs | `examples/output` |

#### Build & Generation
| Target | Description | Dependencies |  
|--------|-------------|--------------|
| `all` | Build complete site | `site` |
| `site` | Generate project and documentation | `gen-project`, `gendoc` |
| `gen-project` | Generate all project files using LinkML | `$(PYMODEL)` |
| `gendoc` | Generate documentation files | `$(DOCDIR)` |
| `standardize-schema` | Process schema with enum descriptions and standardization | None |

#### Documentation & Serving
| Target | Description | Dependencies |
|--------|-------------|--------------|
| `serve` | Start local documentation server | `mkd-serve` |
| `testdoc` | Build docs and run test server | `gendoc`, `serve` |
| `mkd-%` | Generic mkdocs command wrapper | None |

#### Utilities
| Target | Description | Dependencies |
|--------|-------------|--------------|
| `clean` | Remove generated files and directories | None |
| `create-data-harmonizer` | Create data harmonizer (experimental) | None |
| `test1` | Debug target for PATH and yamlfmt testing | None |

### Project Makefile (`project.Makefile`)

#### Excel Generation
| Target | Description | Dependencies |
|--------|-------------|--------------|
| `gen-excel` | Generate Excel templates with split workbooks | `$(SOURCE_SCHEMA_PATH)` |

#### Asset Generation
| Target | Description | Dependencies |
|--------|-------------|--------------|
| `assets/mixs_derived_class_term_schemasheet.tsv` | Generate schema sheets template | `src/mixs/schema/mixs.yaml` |
| `assets/required_and_recommended_slot_usages.tsv` | Analyze slot usage requirements | `src/mixs/schema/mixs.yaml` |
| `assets/class_summary_results.tsv` | Generate class summary using linkml2sheets | Schema + template |
| `assets/mixs-schemasheets-concise.tsv` | Generate concise schema sheets | `src/mixs/schema/mixs.yaml` |
| `assets/mixs-patterns-materialized.yaml` | Materialize patterns in schema | `src/mixs/schema/mixs.yaml` |
| `assets/mixs-schemasheets-concise-global-slots.tsv` | Extract global slots from schema sheets | Concise schema sheets |

#### Analysis & Visualization
| Target | Description | Dependencies |
|--------|-------------|--------------|
| `extensions-dendrogram.pdf` | Create extension similarity dendrogram | None |
| `soil-vs-water-slot-usage.yaml` | Compare Soil vs Water extensions | `src/mixs/schema/mixs.yaml` |

#### Class Model Generation
| Target | Description | Dependencies |
|--------|-------------|--------------|
| `project/class-model-tsvs-organized` | Generate organized class model TSVs | `src/mixs/schema/mixs.yaml` |

## Python Scripts

### Documentation Generation Scripts

#### `term_list_generator.py`
- **Purpose**: Generates markdown table of all schema terms
- **Usage**: `python src/scripts/term_list_generator.py <output-file.md>`
- **Output**: Markdown table with Term Title, Name, and Description
- **Used by**: `gendoc` target

#### `combinations_list_generator.py` 
- **Purpose**: Generates markdown table of combination classes (classes with mixins and is_a)
- **Usage**: `python src/scripts/combinations_list_generator.py <output-file.md>`
- **Output**: Markdown table with combination class names and descriptions
- **Used by**: `gendoc` target

#### `enumerations_list_generator.py`
- **Purpose**: Generates markdown documentation of all enumerations
- **Usage**: `python src/scripts/enumerations_list_generator.py <output-file.md>`
- **Output**: Markdown sections with enumeration names and permissible values
- **Used by**: `gendoc` target

### Schema Processing Scripts

#### `describe_enums_by_slots_using.py`
- **Purpose**: Updates enum descriptions to show which slots use them
- **Arguments**:
  - `--schema_file` (default: `../mixs/schema/mixs.yaml`)
  - `--output_file` (default: `../../mixs_with_enum_descriptions.yaml`)
- **Used by**: `standardize-schema` target

#### `required_supersedes_recommended.py`
- **Purpose**: Identifies conflicting required/recommended slot usages
- **Arguments**:
  - `--input-schema` (required): Schema file path
  - `--output` (required): TSV report output path
- **Used by**: `assets/required_and_recommended_slot_usages.tsv` target

### File Organization Scripts

#### `organize_files.py`
- **Purpose**: Organizes files by MIxS schema structure into extension/checklist folders
- **Arguments**:
  - `--mixs-schema-file` (default: `src/mixs/schema/mixs.yaml`)
  - `--source-directory` (required)
  - `--base-destination-folder` (required)  
  - `--extensions` (required, multiple): File extensions to organize
- **Used by**: `gen-excel`, `project/class-model-tsvs-organized` targets

#### `isolate_slots.py`
- **Purpose**: Filters schema sheets to extract global slots only
- **Usage**: No arguments (hardcoded paths)
- **Files**: 
  - Input: `assets/mixs-schemasheets-concise.tsv`
  - Output: `assets/mixs-schemasheets-concise-global-slots.tsv`
- **Used by**: `assets/mixs-schemasheets-concise-global-slots.tsv` target

### Analysis & Visualization Scripts

#### `extension_distances.py` (Poetry script: `extension-distances`)
- **Purpose**: Generates dendrogram showing extension similarities via clustering
- **Arguments**:
  - `--schema/-s` (default: `src/mixs/schema/mixs.yaml`)
  - `--output/-o` (default: `dendrogram.pdf`)
- **Output**: PDF dendrogram plot
- **Used by**: `extensions-dendrogram.pdf` target

#### `extension_slot_diffrences.py` (Poetry script: `extension-differences`)
- **Purpose**: Compares slots between two extensions using set arithmetic
- **Arguments**:
  - `--schema/-s` (default: `src/mixs/schema/mixs.yaml`)
  - `--ext1` (default: "Soil")
  - `--ext2` (default: "Water") 
- **Output**: YAML to stdout showing differences and intersections
- **Used by**: `soil-vs-water-slot-usage.yaml` target

#### `linkml2class_tsvs.py` (Poetry script: `linkml2class-tsvs`)
- **Purpose**: Generates detailed TSV files for each schema class
- **Arguments**:
  - `--schema-file` (default: `src/mixs/schema/mixs.yaml`)
  - `--output-dir` (default: `project/class-model-tsvs`)
  - `--include-parent-classes`
  - `--eligible-parent-classes` (default: Checklist, Extension)
  - `--delete-attributes`: Attributes to exclude
  - `--metaslots`: Metaslot names to include (extensive list)
  - `--annotations` (default: Expected_value, Preferred_unit)
- **Output**: Directory of TSV files with class attribute details
- **Used by**: `project/class-model-tsvs-organized` target

## Build Pipeline Flow

### Full Build Process (`make all`)
1. `install` - Install dependencies
2. `gen-project` - Generate all project files
3. `gendoc` - Generate documentation
4. `site` - Complete site generation

### Testing Process (`make test`)
1. `test-schema` - Validate schema generation
2. `test-python` - Run Python unit tests  
3. `test-examples` - Process and validate examples

### Documentation Generation (`make gendoc`)
1. Copy source markdown files
2. Generate documentation with LinkML
3. Run term list generator
4. Run combinations list generator  
5. Run enumerations list generator
6. Copy JavaScript assets

### Schema Standardization (`make standardize-schema`)
1. Generate enum descriptions
2. Materialize patterns with gen-linkml
3. Apply yq transformations for standardization
4. Replace original schema file

## File Patterns and Conventions

### Repository Structure

#### User-Facing Directories
- `examples/` - Data file examples in JSON/YAML formats conformant with MIxS
- `mixs-templates/` - Excel (.xlsx) metadata collection templates organized by extension/checklist
- `project/` - Auto-generated LinkML artifacts (JSON-LD, OWL, JSON Schema, etc.)
- `src/data/examples/` - Valid and invalid data examples for `linkml-run-examples` testing
- `src/docs/` - Markdown files converted to HTML for web documentation
- `src/mixs/schema/mixs.yaml` - **Source of Truth**: Main LinkML YAML schema file

#### Developer-Focused Directories  
- `assets/` - Files consumed/generated by maintenance scripts
- `src/mixs/datamodel/` - Generated Python dataclasses from LinkML schema
- `src/doc-templates/` - Jinja2 templates for web documentation customization
- `src/scripts/` - Python discovery/analysis scripts based on MIxS YAML schema
- `tests/` - Test data files
- `docs/` - Generated documentation output
- `examples/output/` - Processed example file outputs

#### Configuration Files
- `pyproject.toml` - Poetry project configuration and dependencies
- `project-generator-config.yaml` - LinkML generator settings and format includes/excludes
- `config.yaml` - Custom LinkML project generator arguments (referenced in README)
- `Makefile` - Pre-defined linkml-project-cookiecutter targets
- `project.Makefile` - Extended/custom Makefile rules
- `.yamlfmt` - YAML formatting configuration

## MIxS Standard Structure

### Terms, Checklists, Extensions, and Combinations

MIxS defines metadata terms for genomic sequences across three main categories:

- **Terms**: Individual metadata attributes/properties that describe samples and sequence metadata
- **Checklists**: Required, recommended, and optional metadata fields for specific genomic sequence types (e.g., MIGS for genomes, MIMS for metagenomes)
- **Extensions**: Environment-specific terms (e.g., Agriculture, Soil, Water extensions)
- **Combinations**: Modular mix-and-match of any checklist with any extension (e.g., MIMSAgriculture = MIMS + Agriculture)

The complete MIxS documentation is available at: https://genomicsstandardsconsortium.github.io/mixs/

### Key Schema Transition Notes

- **MIxS 6.0+**: Full transition to LinkML framework with GitHub-based management
- **MIxS 6.2.0**: Eliminated dependencies on external spreadsheets; YAML schema is now the single source of truth
- **Source of Truth**: `src/mixs/schema/mixs.yaml` replaces all previous spreadsheet-based workflows

## Contributing Guidelines

### Development Workflow
1. Create GitHub issue for each proposed change (atomic: one issue per logical change)
2. Create feature branch from the issue
3. Edit the YAML schema file: `src/mixs/schema/mixs.yaml`
4. Create pull request for Technical Working Group (TWG) review
5. Minor edits (typos, clarifications) can be included in patch releases
6. New terms or significant changes require coordination with minor/major release processes

### GSC Developer Guidelines
- **Schema Editing**: All MIxS term editing happens in `src/mixs/schema/mixs.yaml`
- **Documentation**: Static documentation lives in `src/docs/` as markdown files
- **Contributing Policies**: Detailed guidance in `src/docs/` (policy.md, workflow.md)
- **Code of Conduct**: See CODE_OF_CONDUCT.md

## Common Issues and Notes

1. **Test1 Target Issue**: The `test1` target has a typo (`.yam` instead of `.yaml`)
2. **Missing Help**: The help target doesn't show all available targets from project.Makefile
3. **Dependency Management**: Some targets don't properly declare file dependencies
4. **Poetry Scripts**: Some functionality is available both as Makefile targets and Poetry scripts
5. **Schema Authority**: Remember that `src/mixs/schema/mixs.yaml` is the single source of truth after MIxS 6.2.0

## Usage Examples

```bash
# Full build and test
make install test all

# Generate documentation only
make gendoc

# Clean and rebuild
make clean all

# Generate Excel templates
make gen-excel

# Run specific analysis
poetry run extension-distances --output my-dendrogram.pdf
poetry run extension-differences --ext1 Soil --ext2 BuiltEnvironment
```

This build system provides a comprehensive pipeline for LinkML schema processing, documentation generation, and various analytical outputs for the MIxS standard.